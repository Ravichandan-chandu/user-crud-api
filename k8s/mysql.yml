# 1. Delete old services to clear port locks
kubectl delete svc user-crud-api-service user-crud-mysql --ignore-not-found

# 2. Re-create the MySQL Service on Port 30081
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: user-crud-mysql
spec:
  type: NodePort
  selector:
    app: user-crud-mysql
  ports:
    - port: 3306
      targetPort: 3306
      nodePort: 30081
EOF

# 3. Re-create the API Service on Port 30080
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: user-crud-api-service
spec:
  type: NodePort
  selector:
    app: user-crud-api  # Ensure this matches your API deployment label
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 30080
EOF